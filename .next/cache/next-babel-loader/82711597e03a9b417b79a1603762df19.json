{"ast":null,"code":"function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { addSlugToProduct } from \"./productHelpers\";\nexport const getItemTotal = item => {\n  if (item) {\n    if (item.saleprice) return parseFloat(item.saleprice) * parseFloat(item.qty.value);else if (item.regularprice) return parseFloat(item.regularprice) * parseFloat(item.qty.value);\n  }\n\n  return 0;\n};\nexport const returnSubTotal = items => {\n  // amount =\n  return items.map(el => {\n    if (el) {\n      if (el.saleprice) {\n        if (el.subscribed) {\n          const totalPrice = parseFloat(el.saleprice) * parseFloat(el.qty.value);\n          const disc = totalPrice * el.subscribedDiscountPersent / 100;\n          return parseFloat(totalPrice) - parseFloat(disc);\n        } else {\n          return parseFloat(el.saleprice) * parseFloat(el.qty.value);\n        }\n      } else if (el.regularprice) if (el.subscribed) {\n        const totalPrice = parseFloat(el.regularprice) * parseFloat(el.qty.value);\n        const disc = totalPrice * el.subscribedDiscountPersent / 100;\n        return parseFloat(totalPrice) - parseFloat(disc);\n      } else {\n        return parseFloat(el.regularprice) * parseFloat(el.qty.value);\n      }\n    }\n\n    return 0;\n  }).reduce((a, b) => a + b, 0);\n};\nexport const returnUnSubscribeTotal = items => {\n  return items.filter(el => !el.subscribed).map(el => {\n    if (el) {\n      if (el.saleprice) return parseFloat(el.saleprice) * parseFloat(el.qty.value);else if (el.regularprice) return parseFloat(el.regularprice) * parseFloat(el.qty.value);\n    }\n\n    return 0;\n  }).reduce((a, b) => a + b, 0);\n};\nexport const getTotalWeight = items => {\n  return items.filter(el => el.weight).map(el => el.weight * parseFloat(el.qty.value)).reduce((a, b) => a + b, 0);\n};\nexport const getTotalVolume = items => {\n  // return items\n  //   .filter(el => el.shipping_height && el.shipping_length && el.shipping_width)\n  //   .map(el => el.shipping_height * el.shipping_length * el.shipping_width)\n  //   .reduce((a, b) => a + b, 0);\n  return items.filter(el => el.volume).map(el => el.volume * parseFloat(el.qty.value)).reduce((a, b) => a + b, 0);\n};\nexport const getTotalVariation = item => {\n  if (!item.attributes) return [];\n  return item.attributes.map(el => el ? el.names : null).filter(el => el);\n};\nexport const variablePriceSet = productItem => {\n  if (productItem) {\n    let tempVariable = _objectSpread({}, productItem);\n\n    if (productItem.producttype === \"variable\") {\n      // if (productItem.size && productItem.extract_flavor) {\n      const notNullVariation = productItem.variation.filter(el => el !== null);\n      productItem.attributes.filter(el => el !== null).map(el => el.names);\n      const varCheck = productItem.attributes.filter(el => el !== null).map(attr => {\n        return {\n          key: attr.names,\n          value: productItem[attr.names] ? productItem[attr.names].value : productItem[attr.names]\n        };\n      });\n      let matchedVariable = null;\n\n      if (!varCheck.some(vEl => vEl.value === null || vEl.value === undefined)) {\n        matchedVariable = notNullVariation.find(varEl => {\n          let matchArr = [];\n          varCheck.map(vEl => {\n            matchArr.push(varEl[vEl.key] === vEl.value);\n            return null;\n          });\n          return !matchArr.includes(false);\n        });\n\n        if (matchedVariable) {\n          tempVariable = _objectSpread(_objectSpread({}, productItem), {}, {\n            regularprice: matchedVariable.regular_price,\n            saleprice: matchedVariable.sale_price\n          });\n        } else {\n          tempVariable = _objectSpread(_objectSpread({}, productItem), {}, {\n            regularprice: productItem.dregularprice,\n            saleprice: productItem.dsaleprice\n          });\n        }\n      }\n    } else {\n      if (productItem.producttype === \"simple\" || productItem.combo) {\n        tempVariable = _objectSpread(_objectSpread({}, productItem), {}, {\n          regularprice: productItem.dregularprice,\n          saleprice: productItem.dsaleprice\n        });\n      }\n    }\n\n    return tempVariable;\n  }\n};\nexport const changeCartItemVariation = (varValue, names, item, indexingNo, list) => {\n  if (names === \"qty\") {\n    return {\n      approve: false,\n      update: {\n        oldItem: item,\n        newItem: _objectSpread(_objectSpread({}, item), {}, {\n          [names]: varValue\n        }),\n        remove: null\n      }\n    };\n  } else {\n    const totalVariation = getTotalVariation(item);\n    const foundItem = list.find((el, index) => {\n      const innerFlag = totalVariation.map(varEl => {\n        if (el[varEl]) {\n          if (varEl === names) {\n            return el[varEl].value === varValue.value;\n          }\n\n          return el[varEl].value === item[varEl].value;\n        } else {\n          return null;\n        }\n      }).filter(el => el !== null);\n      return el.productid._id === item.productid._id && innerFlag.every(el => el) && index !== indexingNo;\n    });\n\n    if (foundItem !== undefined && foundItem !== null) {\n      const totalQty = parseInt(foundItem.qty.value) + parseInt(item.qty.value);\n      const qty = {\n        label: totalQty.toString(),\n        value: totalQty.toString()\n      };\n\n      if (item.subscribed || foundItem.subscribed) {\n        return {\n          approve: true,\n          update: {\n            oldItem: foundItem,\n            newItem: _objectSpread(_objectSpread({}, foundItem), {}, {\n              [names]: varValue,\n              qty,\n              subscribed: true,\n              subscribedDiscountPersent: item.subscribedDiscountPersent,\n              subscribedTime: item.subscribedTime\n            }),\n            remove: item\n          }\n        };\n      } else {\n        return {\n          approve: false,\n          update: {\n            oldItem: foundItem,\n            newItem: _objectSpread(_objectSpread({}, foundItem), {}, {\n              [names]: varValue,\n              qty\n            }),\n            remove: item\n          }\n        };\n      }\n    } else {\n      return {\n        approve: false,\n        update: {\n          oldItem: item,\n          newItem: _objectSpread(_objectSpread({}, item), {}, {\n            [names]: varValue\n          }),\n          remove: null\n        }\n      };\n    }\n  }\n};\nexport const verifyProduct = (productItem, items = []) => {\n  const totalVariation = getTotalVariation(productItem);\n  const foundItem = items.find(el => {\n    const innerFlag = totalVariation.map(varEl => {\n      if (el[varEl]) {\n        return el[varEl].value === productItem[varEl].value;\n      } else {\n        return null;\n      }\n    }).filter(el => el !== null).every(el => el);\n    if (!innerFlag) return innerFlag;\n    if (el.combo && productItem.combo) return el._id === productItem._id;\n    if (el.combo) return el._id === productItem.productid._id;\n    if (productItem.combo) return el.productid._id === productItem._id;\n    return el.productid._id === productItem.productid._id;\n  });\n\n  if (foundItem !== undefined && foundItem !== null) {\n    const totalQty = parseInt(foundItem.qty.value) + parseInt(productItem.qty.value);\n    const qty = {\n      label: totalQty,\n      value: totalQty\n    };\n\n    const tempNewItem = _objectSpread(_objectSpread({}, foundItem), {}, {\n      subscribed: productItem.subscribed\n    });\n\n    if (productItem.subscribed) {\n      const {\n        subscribed,\n        subscribedDiscountPersent,\n        subscribedTime\n      } = productItem;\n      return {\n        found: foundItem,\n        item: _objectSpread(_objectSpread({}, foundItem), {}, {\n          qty: qty,\n          subscribed,\n          subscribedDiscountPersent,\n          subscribedTime\n        })\n      };\n    } else if (foundItem.subscribed) {\n      const {\n        subscribedDiscountPersent,\n        subscribedTime\n      } = tempNewItem,\n            newItem = _objectWithoutProperties(tempNewItem, [\"subscribedDiscountPersent\", \"subscribedTime\"]);\n\n      return {\n        found: foundItem,\n        item: _objectSpread({}, newItem)\n      };\n    }\n\n    return {\n      found: foundItem,\n      item: _objectSpread(_objectSpread({}, foundItem), {}, {\n        qty: qty,\n        subscribed: productItem.subscribed\n      })\n    };\n  }\n\n  return {\n    found: null,\n    item: _objectSpread({}, productItem)\n  };\n};\nexport const addItem = (state, newItem) => {\n  const {\n    found,\n    item\n  } = verifyProduct(newItem, state.items);\n\n  if (found) {\n    return modifyProduct(found, item, state);\n  }\n\n  const newItems = [...state.items, newItem];\n  return _objectSpread(_objectSpread({}, state), {}, {\n    items: newItems,\n    subTotal: returnSubTotal(newItems) || 0,\n    unSubscribeProductAmount: returnUnSubscribeTotal(newItems) || 0,\n    totalWeight: getTotalWeight(newItems),\n    totalVolume: getTotalVolume(newItems)\n  });\n};\nexport const setSlugInCart = cart => {\n  return _objectSpread(_objectSpread({}, cart), {}, {\n    items: cart.items ? cart.items.map(el => addSlugToProduct(el)) : []\n  });\n};\nexport const modifyProduct = (oldItem, newItem, state) => {\n  const NewItems = state.items.map(el => {\n    if (el._id === newItem._id) {\n      if (el === oldItem) {\n        return variablePriceSet(newItem);\n      }\n    }\n\n    return el;\n  });\n\n  if (oldItem !== newItem) {\n    return _objectSpread(_objectSpread({}, state), {}, {\n      items: [...NewItems],\n      subTotal: returnSubTotal(NewItems) || 0,\n      unSubscribeProductAmount: returnUnSubscribeTotal(NewItems) || 0,\n      totalWeight: getTotalWeight(NewItems),\n      totalVolume: getTotalVolume(NewItems)\n    });\n  }\n\n  return state;\n};\nexport const removeItem = (state, item) => {\n  const newItems = [...state.items.filter(el => el !== item)];\n  return _objectSpread(_objectSpread({}, state), {}, {\n    items: newItems,\n    subTotal: returnSubTotal(newItems) || 0,\n    unSubscribeProductAmount: returnUnSubscribeTotal(newItems) || 0,\n    totalWeight: getTotalWeight(newItems),\n    totalVolume: getTotalVolume(newItems)\n  });\n};","map":null,"metadata":{},"sourceType":"module"}