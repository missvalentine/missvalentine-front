{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useEffect } from \"react\";\nimport dynamic from 'next/dynamic';\nvar CheckoutLayout = dynamic(function () {\n  return import(\"../components/Layouts/CheckoutLayout\");\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"../components/Layouts/CheckoutLayout\")];\n    },\n    modules: [\"../components/Layouts/CheckoutLayout\"]\n  }\n});\nvar Layout = dynamic(function () {\n  return import(\"../components/Layouts/Layout\");\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"../components/Layouts/Layout\")];\n    },\n    modules: [\"../components/Layouts/Layout\"]\n  }\n});\nvar Heading = dynamic(function () {\n  return import(\"../components/Heading\");\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"../components/Heading\")];\n    },\n    modules: [\"../components/Heading\"]\n  }\n});\nimport { Steps } from \"antd\";\nvar CheckoutInfo = dynamic(function () {\n  return import(\"../components/checkout-tabs/CheckoutInfo\");\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"../components/checkout-tabs/CheckoutInfo\")];\n    },\n    modules: [\"../components/checkout-tabs/CheckoutInfo\"]\n  }\n});\nimport { addAddress, setEditable } from \"../redux/actions\";\nimport { connect } from \"react-redux\";\nimport projectSettings, { projectName } from \"../constants/projectSettings\";\nimport checkAddressDuplicate from \"../services/helpers/address\";\nvar CheckoutShipping = dynamic(function () {\n  return import(\"../components/checkout-tabs/CheckoutShipping\");\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"../components/checkout-tabs/CheckoutShipping\")];\n    },\n    modules: [\"../components/checkout-tabs/CheckoutShipping\"]\n  }\n});\nvar CheckoutPayment = dynamic(function () {\n  return import(\"../components/checkout-tabs/CheckoutPayment\");\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"../components/checkout-tabs/CheckoutPayment\")];\n    },\n    modules: [\"../components/checkout-tabs/CheckoutPayment\"]\n  }\n});\nvar Loader = dynamic(function () {\n  return import(\"../components/Loader\");\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"../components/Loader\")];\n    },\n    modules: [\"../components/Loader\"]\n  }\n});\nimport Link from \"next/link\";\nimport { FullModal } from \"../components/modal\";\nimport ReactIcon from \"react-icons-kit\";\nimport { ic_clear } from \"react-icons-kit/md/\";\nimport Icon from \"react-icons-kit\";\nimport { ic_error_outline } from \"react-icons-kit/md/\";\nimport { LazyLoadImage } from \"react-lazy-load-image-component\";\nvar baseUrl = projectSettings.baseUrl;\n\nvar Checkout = function Checkout(_ref) {\n  var addAddress = _ref.addAddress,\n      user = _ref.user,\n      isLoading = _ref.isLoading,\n      props = _objectWithoutProperties(_ref, [\"addAddress\", \"user\", \"isLoading\"]);\n\n  var _useState = useState(1),\n      activeAddress = _useState[0],\n      setActiveAddress = _useState[1];\n\n  var _useState2 = useState(0),\n      currentStep = _useState2[0],\n      setCurrentStep = _useState2[1];\n\n  var _useState3 = useState({}),\n      infoDetails = _useState3[0],\n      setInfoDetails = _useState3[1];\n\n  var _useState4 = useState(null),\n      mainAddress = _useState4[0],\n      setMainAddress = _useState4[1];\n\n  var _useState5 = useState(null),\n      billingAddress = _useState5[0],\n      setBillingAddress = _useState5[1];\n\n  var _useState6 = useState(null),\n      shippingDetail = _useState6[0],\n      setShippingDetail = _useState6[1];\n\n  var _useState7 = useState(null),\n      shippingSendData = _useState7[0],\n      setShippingSendData = _useState7[1];\n\n  var _useState8 = useState(false),\n      isModal = _useState8[0],\n      setIsModal = _useState8[1];\n\n  var _useState9 = useState(null),\n      failedRes = _useState9[0],\n      setFailedRes = _useState9[1];\n\n  var _useState10 = useState(null),\n      isSuccess = _useState10[0],\n      setIsSuccess = _useState10[1];\n\n  var _useState11 = useState(null),\n      order = _useState11[0],\n      setOrder = _useState11[1];\n\n  useEffect(function () {\n    if (currentStep === 2) {\n      if (props.isEditable) {\n        props.setEditable(false);\n      }\n    } else {\n      if (!props.isEditable) {\n        props.setEditable(true);\n      }\n    }\n  });\n\n  var onInfoSubmit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e, values, address, addressShip) {\n      var newAddress, sameShipping, saveaddress, saveaddress_ship, newAddress_ship, addresses, addressA, addressB, addressSelect, addressSelect_ship, rest, shippingData, email, phone, _shippingData, allAddresses, idTime, userId, newAddressA, newAddressB, isDuplicateA, isDuplicateB;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              console.log(\"reached here\");\n              console.log({\n                e: e,\n                values: values\n              });\n              console.log(address);\n              newAddress = values.newAddress, sameShipping = values.sameShipping, saveaddress = values.saveaddress, saveaddress_ship = values.saveaddress_ship, newAddress_ship = values.newAddress_ship;\n              addresses = {}, addressA = {}, addressB = {};\n\n              if (!newAddress) {\n                if (sameShipping) {\n                  addressA = addressB = _objectSpread({}, values.addressSelect ? _objectSpread({}, values.addressSelect) : _objectSpread({}, address)); // addressB = { ...values.addressSelect };\n\n                  console.log(\"checkA 1 \", addressA);\n                } else {\n                  if (!newAddress_ship) {\n                    addressA = _objectSpread({}, values.addressSelect ? _objectSpread({}, values.addressSelect) : _objectSpread({}, address));\n                    addressB = _objectSpread({}, values.addressSelect_ship ? _objectSpread({}, values.addressSelect_ship) : _objectSpread({}, addressShip));\n                    console.log(\"checkA 2\", addressA);\n                  } else {\n                    addressSelect = values.addressSelect, addressSelect_ship = values.addressSelect_ship, rest = _objectWithoutProperties(values, [\"addressSelect\", \"addressSelect_ship\"]);\n                    addressA = _objectSpread({}, addressSelect);\n                    shippingData = _objectSpread({}, rest);\n                    addressB = {\n                      addressStr: \"\".concat(shippingData[\"city-ship\"], \", \").concat(shippingData[\"state-ship\"], \", \").concat(shippingData[\"country-ship\"], \", \").concat(shippingData[\"zip-ship\"]).trim(),\n                      city: \"\".concat(shippingData[\"city-ship\"]),\n                      country: \"\".concat(shippingData[\"country-ship\"]),\n                      email: shippingData.email,\n                      firstname: shippingData[\"firstname_ship\"],\n                      lastname: shippingData[\"lastname_ship\"],\n                      phone: shippingData[\"phone_ship\"],\n                      state: shippingData[\"state-ship\"],\n                      zip: shippingData[\"zip-ship\"],\n                      other: \"\".concat(shippingData[\"city-ship\"], \", \").concat(shippingData[\"state-ship\"], \", \").concat(shippingData[\"country-ship\"]).split(\",\" || \"\")[0]\n                    };\n                    console.log(\"checkA 3\", addressA);\n                  }\n                }\n              } else {\n                if (sameShipping) {\n                  email = values.email, phone = values.phone;\n                  addressA = addressB = _objectSpread(_objectSpread({}, address), {}, {\n                    //...values,\n                    email: email,\n                    phone: phone\n                  });\n                  console.log(\"checkA 4\", addressA);\n                } else {\n                  if (!newAddress_ship) {\n                    addressA = _objectSpread(_objectSpread({}, address), {}, {\n                      phone: values.phone,\n                      email: values.email\n                    });\n                    addressB = _objectSpread({}, values.addressSelect_ship);\n                  } else {\n                    addressA = _objectSpread(_objectSpread({}, address), {}, {\n                      phone: values.phone,\n                      email: values.email\n                    });\n                    _shippingData = _objectSpread({}, values);\n                    addressB = {\n                      addressStr: \"\".concat(_shippingData[\"city-ship\"], \", \").concat(_shippingData[\"state-ship\"], \", \").concat(_shippingData[\"country-ship\"], \", \").concat(_shippingData[\"zip-ship\"]).trim(),\n                      city: \"\".concat(_shippingData[\"city-ship\"]),\n                      country: \"\".concat(_shippingData[\"country-ship\"]),\n                      email: _shippingData.email,\n                      firstname: _shippingData[\"firstname_ship\"],\n                      lastname: _shippingData[\"lastname_ship\"],\n                      phone: _shippingData[\"phone_ship\"],\n                      state: _shippingData[\"state-ship\"],\n                      zip: _shippingData[\"zip-ship\"],\n                      other: \"\".concat(_shippingData[\"city-ship\"], \", \").concat(_shippingData[\"state-ship\"], \", \").concat(_shippingData[\"country-ship\"]).split(\",\" || \"\")[0]\n                    };\n                  }\n                }\n              } // const {\n              //   email,\n              //   email_ship,\n              //   firstname,\n              //   firstname_ship,\n              //   lastname,\n              //   lastname_ship,\n              //   phone,\n              //   phone_ship,\n              //   sameShipping,\n              //   saveaddress,\n              //   saveaddress_ship,\n              //   addressSelect,\n              //   addressSelect_ship,\n              // } = values;\n              // const addressA = {\n              //   ...address,\n              //   email,\n              //   firstname,\n              //   lastname,\n              //   phone,\n              // };\n              // const addressB = {\n              //   ...addressShip,\n              //   email: email_ship,\n              //   firstname: firstname_ship,\n              //   lastname: lastname_ship,\n              //   phone: phone_ship,\n              // };\n\n\n              allAddresses = props.address.address || [];\n              idTime = new Date().getTime();\n              console.log({\n                user: user\n              });\n              userId = user._id;\n              newAddressA = _objectSpread(_objectSpread({}, addressA), {}, {\n                id: idTime\n              });\n              newAddressB = _objectSpread(_objectSpread({}, addressB), {}, {\n                id: idTime + 10\n              });\n              console.log(newAddressA);\n              console.log(allAddresses);\n              _context.next = 16;\n              return checkAddressDuplicate(newAddressA, allAddresses);\n\n            case 16:\n              isDuplicateA = _context.sent;\n              _context.next = 19;\n              return checkAddressDuplicate(newAddressB, allAddresses);\n\n            case 19:\n              isDuplicateB = _context.sent;\n\n              if (saveaddress && saveaddress_ship) {\n                if (allAddresses.length < 1 || !isDuplicateA && !isDuplicateB) {\n                  addAddress(userId, [newAddressA, newAddressB], props.address, allAddresses);\n                } else if (!isDuplicateA) {\n                  addAddress(userId, newAddressA, props.address, allAddresses);\n                } else if (!isDuplicateB) {\n                  addAddress(userId, newAddressA, props.address, allAddresses);\n                }\n              } else if (saveaddress) {\n                if (!isDuplicateA || allAddresses.length < 1) {\n                  addAddress(userId, newAddressA, props.address, allAddresses);\n                }\n              } else if (saveaddress_ship) {\n                if (!isDuplicateB || allAddresses.length < 1) {\n                  addAddress(userId, newAddressB, props.address, allAddresses);\n                }\n              } // const mainAddressRaw = addressSelect\n              //   ? {\n              //       ...addressSelect,\n              //       // phone,\n              //       email,\n              //     }\n              //   : {\n              //       ...address,\n              //       email,\n              //       phone,\n              //     };\n\n\n              setInfoDetails(_objectSpread({}, values));\n              console.log(\"reached here\");\n              console.log(\"A\", addressA);\n              console.log(\"B\", addressB);\n              setMainAddress(addressA);\n              setBillingAddress( //   addressSelect_ship || addressSelect || addressShip || address\n              addressB);\n              setCurrentStep(1);\n\n            case 28:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onInfoSubmit(_x, _x2, _x3, _x4) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onShippingSubmit = function onShippingSubmit(e, values, shippingSendData) {\n    setShippingDetail(values);\n    setCurrentStep(2);\n    console.log({\n      shippingSendData: shippingSendData\n    });\n    setShippingSendData(shippingSendData);\n  };\n\n  var onPaymentSubmit = function onPaymentSubmit(order) {\n    if (order) {\n      setOrder(order);\n      setIsSuccess(true);\n    }\n  };\n\n  var onPaymentFail = function onPaymentFail(res) {\n    console.log({\n      res: res\n    });\n\n    switch (res.config.url) {\n      case baseUrl + \"/ship/confirm/\":\n        setFailedRes(\"shipment failed\");\n        break;\n\n      case baseUrl + \"/authorize/create/subscription/\":\n      case baseUrl + \"/authorize/create/subscription/profile/\":\n      case baseUrl + \"/authorize/create/subscription/bank/\":\n        setFailedRes(\"subscription failed\");\n        break;\n\n      case baseUrl + \"/authorize/chargeprofile/\":\n      case baseUrl + \"/authorize/charge/\":\n      case baseUrl + \"/authorize/charge/bank/\":\n        setFailedRes(\"Transaction failed\");\n        break;\n\n      default:\n        setFailedRes(\"something went wrong\");\n    }\n\n    setIsModal(true);\n  };\n\n  console.log({\n    isLoading: isLoading\n  });\n  var checkoutClass = \"\";\n  var loaderClass = \"c-hidden\";\n\n  if (isLoading) {\n    checkoutClass = \"c-hidden\";\n    loaderClass = \"\";\n  }\n\n  console.log({\n    loaderClass: loaderClass\n  });\n\n  if (!props.isPersist) {\n    return __jsx(\"div\", null, __jsx(Loader, null));\n  } else if (props.cartItems && props.cartItems.length == 0 && !isSuccess) {\n    return __jsx(Layout, {\n      headerTheme: \"black\"\n    }, __jsx(\"div\", {\n      className: \"o-success\"\n    }, __jsx(\"div\", {\n      className: \"o-success__main o-success__main--center\"\n    }, __jsx(Heading, {\n      versions: [\"large\", \"upper\"],\n      parentClass: \"c-privacy\"\n    }, \"0 Items\"), __jsx(\"div\", {\n      className: \"mt-3\"\n    }), __jsx(Heading, {\n      versions: [\"small\"],\n      parentClass: \"c-privacy \"\n    }, \"Your bag is empty.\")), __jsx(\"div\", {\n      className: \"o-success__btn-wrap w-30 m-auto \"\n    }, __jsx(\"div\", {\n      className: \"row\",\n      style: {\n        justifyContent: \"center\"\n      }\n    }, __jsx(Link, {\n      href: \"/shop\"\n    }, __jsx(\"a\", {\n      className: \"c-btn c-btn--dark\"\n    }, \"Continue shopping\"))))), __jsx(\"br\", null));\n  }\n\n  if (isSuccess) {\n    return __jsx(Layout, {\n      headerTheme: \"black\"\n    }, __jsx(\"div\", {\n      className: \"o-success\"\n    }, __jsx(\"div\", {\n      className: \"o-success__banner\"\n    }, __jsx(\"h1\", {\n      className: \"o-success__banner--text\"\n    }, \"thank you for your order\")), __jsx(\"div\", {\n      className: \"o-success__main o-success__main--center\"\n    }, __jsx(\"br\", null), __jsx(\"h1\", {\n      className: \"o-success__main--orderno\"\n    }, \"Order Number: \", order && order._id.slice(-8)), __jsx(\"br\", null), __jsx(\"p\", {\n      className: \"o-success__descp mt-3\"\n    }, \"The order information will be sent via e-mail to\", \" \", order && order.userDetails && order.userDetails.email, \" \")), __jsx(\"div\", {\n      className: \"o-success__btn-wrap w-30 m-auto \"\n    }, __jsx(\"div\", {\n      className: \"row\",\n      style: {\n        justifyContent: \"center\"\n      }\n    }, __jsx(Link, {\n      href: \"/shop\"\n    }, __jsx(\"a\", {\n      className: \"c-btn c-btn--dark\"\n    }, \"Continue Shopping\"))))), __jsx(\"br\", null));\n  }\n\n  return __jsx(\"div\", {\n    className: \"loaderClass\"\n  }, isLoading && __jsx(Loader, null), __jsx(\"div\", {\n    className: checkoutClass\n  }, __jsx(CheckoutLayout, null, __jsx(\"div\", {\n    className: \"c-checkout\"\n  }, __jsx(Heading, {\n    parentClass: \"d-none d-md-block c-checkout \",\n    versions: [\"default\", \"upper\"]\n  }, \"Checkout\"), __jsx(\"div\", {\n    className: \"c-checkout__nav-wrapper\"\n  }, __jsx(Steps, {\n    current: currentStep\n  }, __jsx(Steps.Step, {\n    onClick: function onClick() {\n      currentStep > 0 && setCurrentStep(0);\n    },\n    title: \"Information\"\n  }), __jsx(Steps.Step, {\n    onClick: function onClick() {\n      currentStep > 1 && setCurrentStep(1);\n    },\n    title: \"Shipping\"\n  }), __jsx(Steps.Step, {\n    onClick: function onClick() {\n      currentStep > 2 && setCurrentStep(2);\n    },\n    title: \"Payment\"\n  }))), __jsx(\"div\", {\n    className: \"c-checkout__main-wrapper\"\n  }, currentStep === 0 && __jsx(CheckoutInfo, {\n    oldValues: infoDetails,\n    onSubmit: onInfoSubmit\n  }), currentStep == 1 && __jsx(CheckoutShipping, {\n    oldValues: shippingDetail,\n    email: infoDetails.email,\n    address: mainAddress,\n    onSubmit: onShippingSubmit\n  }), currentStep === 2 && __jsx(CheckoutPayment, {\n    oldValues: null,\n    email: infoDetails.email,\n    onFailed: onPaymentFail,\n    shippingDetail: shippingDetail,\n    address: mainAddress,\n    billingAddress: billingAddress,\n    shippingSendData: shippingSendData,\n    onSubmit: onPaymentSubmit\n  }))), __jsx(FullModal, {\n    isOpen: isModal,\n    toggle: function toggle() {\n      return setIsModal(!isModal);\n    }\n  }, __jsx(\"div\", {\n    className: \"c-submit-r__product-selector\"\n  }, __jsx(\"div\", {\n    className: \"modal__logo-wrapper\"\n  }, __jsx(\"a\", {\n    className: \"c-logo  modal-footer__logo\",\n    href: \"/\"\n  }, __jsx(LazyLoadImage, {\n    src: \"/images/logo-new.png\",\n    className: \"modal__logo-img\",\n    alt: projectName\n  })), __jsx(\"div\", {\n    className: \"modal__heading\"\n  }, __jsx(\"h2\", {\n    className: \"modal__heading-text\"\n  }, \"Order Failed :-\"))), __jsx(\"div\", {\n    className: \"modal-dismiss\",\n    onClick: function onClick() {\n      return setIsModal(!isModal);\n    }\n  }, __jsx(ReactIcon, {\n    icon: ic_clear,\n    size: \"32\"\n  })), __jsx(\"div\", {\n    className: \"c-susbmit-r__wrapper justify-content-center\"\n  }, __jsx(Icon, {\n    icon: ic_error_outline,\n    className: \"text-center mr-4 clr-red\",\n    size: \"64\"\n  }), __jsx(\"h3\", null, failedRes)))))));\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    address: state.address,\n    user: state.user,\n    isLoading: state.loading.isLoading,\n    isEditable: state.cart.isEditable,\n    cartItems: state.cart.items\n  };\n};\n\nvar mapActionToProps = {\n  addAddress: addAddress,\n  setEditable: setEditable\n};\nexport default connect(mapStateToProps, mapActionToProps)(Checkout);","map":null,"metadata":{},"sourceType":"module"}