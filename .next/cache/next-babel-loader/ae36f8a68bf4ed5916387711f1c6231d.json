{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { addSlugToProduct } from \"./productHelpers\";\nexport var getItemTotal = function getItemTotal(item) {\n  if (item) {\n    if (item.saleprice) return parseFloat(item.saleprice) * parseFloat(item.qty.value);else if (item.regularprice) return parseFloat(item.regularprice) * parseFloat(item.qty.value);\n  }\n\n  return 0;\n};\nexport var returnSubTotal = function returnSubTotal(items) {\n  // amount =\n  return items.map(function (el) {\n    if (el) {\n      if (el.saleprice) {\n        if (el.subscribed) {\n          var totalPrice = parseFloat(el.saleprice) * parseFloat(el.qty.value);\n          var disc = totalPrice * el.subscribedDiscountPersent / 100;\n          return parseFloat(totalPrice) - parseFloat(disc);\n        } else {\n          return parseFloat(el.saleprice) * parseFloat(el.qty.value);\n        }\n      } else if (el.regularprice) if (el.subscribed) {\n        var _totalPrice = parseFloat(el.regularprice) * parseFloat(el.qty.value);\n\n        var _disc = _totalPrice * el.subscribedDiscountPersent / 100;\n\n        return parseFloat(_totalPrice) - parseFloat(_disc);\n      } else {\n        return parseFloat(el.regularprice) * parseFloat(el.qty.value);\n      }\n    }\n\n    return 0;\n  }).reduce(function (a, b) {\n    return a + b;\n  }, 0);\n};\nexport var returnUnSubscribeTotal = function returnUnSubscribeTotal(items) {\n  return items.filter(function (el) {\n    return !el.subscribed;\n  }).map(function (el) {\n    if (el) {\n      if (el.saleprice) return parseFloat(el.saleprice) * parseFloat(el.qty.value);else if (el.regularprice) return parseFloat(el.regularprice) * parseFloat(el.qty.value);\n    }\n\n    return 0;\n  }).reduce(function (a, b) {\n    return a + b;\n  }, 0);\n};\nexport var getTotalWeight = function getTotalWeight(items) {\n  return items.filter(function (el) {\n    return el.weight;\n  }).map(function (el) {\n    return el.weight * parseFloat(el.qty.value);\n  }).reduce(function (a, b) {\n    return a + b;\n  }, 0);\n};\nexport var getTotalVolume = function getTotalVolume(items) {\n  // return items\n  //   .filter(el => el.shipping_height && el.shipping_length && el.shipping_width)\n  //   .map(el => el.shipping_height * el.shipping_length * el.shipping_width)\n  //   .reduce((a, b) => a + b, 0);\n  return items.filter(function (el) {\n    return el.volume;\n  }).map(function (el) {\n    return el.volume * parseFloat(el.qty.value);\n  }).reduce(function (a, b) {\n    return a + b;\n  }, 0);\n};\nexport var getTotalVariation = function getTotalVariation(item) {\n  if (!item.attributes) return [];\n  return item.attributes.map(function (el) {\n    return el ? el.names : null;\n  }).filter(function (el) {\n    return el;\n  });\n};\nexport var variablePriceSet = function variablePriceSet(productItem) {\n  if (productItem) {\n    var tempVariable = _objectSpread({}, productItem);\n\n    if (productItem.producttype === \"variable\") {\n      // if (productItem.size && productItem.extract_flavor) {\n      var notNullVariation = productItem.variation.filter(function (el) {\n        return el !== null;\n      });\n      productItem.attributes.filter(function (el) {\n        return el !== null;\n      }).map(function (el) {\n        return el.names;\n      });\n      var varCheck = productItem.attributes.filter(function (el) {\n        return el !== null;\n      }).map(function (attr) {\n        return {\n          key: attr.names,\n          value: productItem[attr.names] ? productItem[attr.names].value : productItem[attr.names]\n        };\n      });\n      var matchedVariable = null;\n\n      if (!varCheck.some(function (vEl) {\n        return vEl.value === null || vEl.value === undefined;\n      })) {\n        matchedVariable = notNullVariation.find(function (varEl) {\n          var matchArr = [];\n          varCheck.map(function (vEl) {\n            matchArr.push(varEl[vEl.key] === vEl.value);\n            return null;\n          });\n          return !matchArr.includes(false);\n        });\n\n        if (matchedVariable) {\n          tempVariable = _objectSpread(_objectSpread({}, productItem), {}, {\n            regularprice: matchedVariable.regular_price,\n            saleprice: matchedVariable.sale_price\n          });\n        } else {\n          tempVariable = _objectSpread(_objectSpread({}, productItem), {}, {\n            regularprice: productItem.dregularprice,\n            saleprice: productItem.dsaleprice\n          });\n        }\n      }\n    } else {\n      if (productItem.producttype === \"simple\" || productItem.combo) {\n        tempVariable = _objectSpread(_objectSpread({}, productItem), {}, {\n          regularprice: productItem.dregularprice,\n          saleprice: productItem.dsaleprice\n        });\n      }\n    }\n\n    return tempVariable;\n  }\n};\nexport var changeCartItemVariation = function changeCartItemVariation(varValue, names, item, indexingNo, list) {\n  if (names === \"qty\") {\n    return {\n      approve: false,\n      update: {\n        oldItem: item,\n        newItem: _objectSpread(_objectSpread({}, item), {}, _defineProperty({}, names, varValue)),\n        remove: null\n      }\n    };\n  } else {\n    var totalVariation = getTotalVariation(item);\n    var foundItem = list.find(function (el, index) {\n      var innerFlag = totalVariation.map(function (varEl) {\n        if (el[varEl]) {\n          if (varEl === names) {\n            return el[varEl].value === varValue.value;\n          }\n\n          return el[varEl].value === item[varEl].value;\n        } else {\n          return null;\n        }\n      }).filter(function (el) {\n        return el !== null;\n      });\n      return el.productid._id === item.productid._id && innerFlag.every(function (el) {\n        return el;\n      }) && index !== indexingNo;\n    });\n\n    if (foundItem !== undefined && foundItem !== null) {\n      var totalQty = parseInt(foundItem.qty.value) + parseInt(item.qty.value);\n      var qty = {\n        label: totalQty.toString(),\n        value: totalQty.toString()\n      };\n\n      if (item.subscribed || foundItem.subscribed) {\n        var _objectSpread3;\n\n        return {\n          approve: true,\n          update: {\n            oldItem: foundItem,\n            newItem: _objectSpread(_objectSpread({}, foundItem), {}, (_objectSpread3 = {}, _defineProperty(_objectSpread3, names, varValue), _defineProperty(_objectSpread3, \"qty\", qty), _defineProperty(_objectSpread3, \"subscribed\", true), _defineProperty(_objectSpread3, \"subscribedDiscountPersent\", item.subscribedDiscountPersent), _defineProperty(_objectSpread3, \"subscribedTime\", item.subscribedTime), _objectSpread3)),\n            remove: item\n          }\n        };\n      } else {\n        var _objectSpread4;\n\n        return {\n          approve: false,\n          update: {\n            oldItem: foundItem,\n            newItem: _objectSpread(_objectSpread({}, foundItem), {}, (_objectSpread4 = {}, _defineProperty(_objectSpread4, names, varValue), _defineProperty(_objectSpread4, \"qty\", qty), _objectSpread4)),\n            remove: item\n          }\n        };\n      }\n    } else {\n      return {\n        approve: false,\n        update: {\n          oldItem: item,\n          newItem: _objectSpread(_objectSpread({}, item), {}, _defineProperty({}, names, varValue)),\n          remove: null\n        }\n      };\n    }\n  }\n};\nexport var verifyProduct = function verifyProduct(productItem) {\n  var items = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  var totalVariation = getTotalVariation(productItem);\n  var foundItem = items.find(function (el) {\n    var innerFlag = totalVariation.map(function (varEl) {\n      if (el[varEl]) {\n        return el[varEl].value === productItem[varEl].value;\n      } else {\n        return null;\n      }\n    }).filter(function (el) {\n      return el !== null;\n    }).every(function (el) {\n      return el;\n    });\n    if (!innerFlag) return innerFlag;\n    if (el.combo && productItem.combo) return el._id === productItem._id;\n    if (el.combo) return el._id === productItem.productid._id;\n    if (productItem.combo) return el.productid._id === productItem._id;\n    return el.productid._id === productItem.productid._id;\n  });\n\n  if (foundItem !== undefined && foundItem !== null) {\n    var totalQty = parseInt(foundItem.qty.value) + parseInt(productItem.qty.value);\n    var qty = {\n      label: totalQty,\n      value: totalQty\n    };\n\n    var tempNewItem = _objectSpread(_objectSpread({}, foundItem), {}, {\n      subscribed: productItem.subscribed\n    });\n\n    if (productItem.subscribed) {\n      var subscribed = productItem.subscribed,\n          subscribedDiscountPersent = productItem.subscribedDiscountPersent,\n          subscribedTime = productItem.subscribedTime;\n      return {\n        found: foundItem,\n        item: _objectSpread(_objectSpread({}, foundItem), {}, {\n          qty: qty,\n          subscribed: subscribed,\n          subscribedDiscountPersent: subscribedDiscountPersent,\n          subscribedTime: subscribedTime\n        })\n      };\n    } else if (foundItem.subscribed) {\n      var _subscribedDiscountPersent = tempNewItem.subscribedDiscountPersent,\n          _subscribedTime = tempNewItem.subscribedTime,\n          newItem = _objectWithoutProperties(tempNewItem, [\"subscribedDiscountPersent\", \"subscribedTime\"]);\n\n      return {\n        found: foundItem,\n        item: _objectSpread({}, newItem)\n      };\n    }\n\n    return {\n      found: foundItem,\n      item: _objectSpread(_objectSpread({}, foundItem), {}, {\n        qty: qty,\n        subscribed: productItem.subscribed\n      })\n    };\n  }\n\n  return {\n    found: null,\n    item: _objectSpread({}, productItem)\n  };\n};\nexport var addItem = function addItem(state, newItem) {\n  var _verifyProduct = verifyProduct(newItem, state.items),\n      found = _verifyProduct.found,\n      item = _verifyProduct.item;\n\n  if (found) {\n    return modifyProduct(found, item, state);\n  }\n\n  var newItems = [].concat(_toConsumableArray(state.items), [newItem]);\n  return _objectSpread(_objectSpread({}, state), {}, {\n    items: newItems,\n    subTotal: returnSubTotal(newItems) || 0,\n    unSubscribeProductAmount: returnUnSubscribeTotal(newItems) || 0,\n    totalWeight: getTotalWeight(newItems),\n    totalVolume: getTotalVolume(newItems)\n  });\n};\nexport var setSlugInCart = function setSlugInCart(cart) {\n  return _objectSpread(_objectSpread({}, cart), {}, {\n    items: cart.items ? cart.items.map(function (el) {\n      return addSlugToProduct(el);\n    }) : []\n  });\n};\nexport var modifyProduct = function modifyProduct(oldItem, newItem, state) {\n  var NewItems = state.items.map(function (el) {\n    if (el._id === newItem._id) {\n      if (el === oldItem) {\n        return variablePriceSet(newItem);\n      }\n    }\n\n    return el;\n  });\n\n  if (oldItem !== newItem) {\n    return _objectSpread(_objectSpread({}, state), {}, {\n      items: _toConsumableArray(NewItems),\n      subTotal: returnSubTotal(NewItems) || 0,\n      unSubscribeProductAmount: returnUnSubscribeTotal(NewItems) || 0,\n      totalWeight: getTotalWeight(NewItems),\n      totalVolume: getTotalVolume(NewItems)\n    });\n  }\n\n  return state;\n};\nexport var removeItem = function removeItem(state, item) {\n  var newItems = _toConsumableArray(state.items.filter(function (el) {\n    return el !== item;\n  }));\n\n  return _objectSpread(_objectSpread({}, state), {}, {\n    items: newItems,\n    subTotal: returnSubTotal(newItems) || 0,\n    unSubscribeProductAmount: returnUnSubscribeTotal(newItems) || 0,\n    totalWeight: getTotalWeight(newItems),\n    totalVolume: getTotalVolume(newItems)\n  });\n};","map":null,"metadata":{},"sourceType":"module"}