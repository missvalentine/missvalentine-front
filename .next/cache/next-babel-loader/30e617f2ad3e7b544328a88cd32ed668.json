{"ast":null,"code":"function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { combineLoop } from \"box-dimension-calculator\";\nimport { addSlugToProduct } from \"./product\";\nimport _ from \"lodash\";\nimport projectSettings from \"../../constants/projectSettings\";\nexport const getItemTotal = item => {\n  if (item) {\n    if (item.saleprice) return parseFloat(item.saleprice) * parseFloat(item.qty);else if (item.regularprice) return parseFloat(item.regularprice) * parseFloat(item.qty);\n  }\n\n  return 0;\n};\nexport const returnSubTotal = items => {\n  // amount =\n  return items.map(el => {\n    if (el) {\n      if (el.saleprice) {\n        if (el.subscribed) {\n          const totalPrice = parseFloat(el.saleprice) * parseFloat(el.qty);\n          const disc = totalPrice * el.subscribedDiscountPersent / 100;\n          return parseFloat(totalPrice) - parseFloat(disc);\n        } else {\n          return parseFloat(el.saleprice) * parseFloat(el.qty);\n        }\n      } else if (el.regularprice) if (el.subscribed) {\n        const totalPrice = parseFloat(el.regularprice) * parseFloat(el.qty);\n        const disc = totalPrice * el.subscribedDiscountPersent / 100;\n        return parseFloat(totalPrice) - parseFloat(disc);\n      } else {\n        return parseFloat(el.regularprice) * parseFloat(el.qty);\n      }\n    }\n\n    return 0;\n  }).reduce((a, b) => a + b, 0);\n};\nexport const returnUnSubscribeTotal = items => {\n  return items.filter(el => !el.subscribed).map(el => {\n    if (el) {\n      if (el.saleprice) return parseFloat(el.saleprice) * parseFloat(el.qty);else if (el.regularprice) return parseFloat(el.regularprice) * parseFloat(el.qty);\n    }\n\n    return 0;\n  }).reduce((a, b) => a + b, 0);\n};\nexport const getTotalWeight = items => {\n  return items.filter(el => el.weight).map(el => el.weight * parseFloat(el.qty)).reduce((a, b) => a + b, 0);\n};\nexport const getTotalVolume = items => {\n  // return items\n  //   .filter(el => el.shipping_height && el.shipping_length && el.shipping_width)\n  //   .map(el => el.shipping_height * el.shipping_length * el.shipping_width)\n  //   .reduce((a, b) => a + b, 0);\n  return items.filter(el => el.volume).map(el => el.volume * parseFloat(el.qty)).reduce((a, b) => a + b, 0);\n};\nexport const getTotalVariation = item => {\n  if (!item.attributes) return [];\n  return item.attributes.map(el => el ? el.names : null).filter(el => el);\n};\nexport const variablePriceSet = productItem => {\n  if (productItem) {\n    let tempVariable = _objectSpread({}, productItem);\n\n    if (productItem.producttype === \"variable\") {\n      // if (productItem.size && productItem.extract_flavor) {\n      const notNullVariation = productItem.variation.filter(el => el !== null);\n      productItem.attributes.filter(el => el !== null).map(el => el.names);\n      const varCheck = productItem.attributes.filter(el => el !== null).map(attr => {\n        return {\n          key: attr.names,\n          value: productItem[attr.names] ? productItem[attr.names].value : productItem[attr.names]\n        };\n      });\n      let matchedVariable = null;\n\n      if (!varCheck.some(vEl => vEl.value === null || vEl.value === undefined)) {\n        matchedVariable = notNullVariation.find(varEl => {\n          let matchArr = [];\n          varCheck.map(vEl => {\n            matchArr.push(varEl[vEl.key] === vEl.value);\n            return null;\n          });\n          return !matchArr.includes(false);\n        });\n\n        if (matchedVariable) {\n          tempVariable = _objectSpread(_objectSpread({}, productItem), {}, {\n            regularprice: matchedVariable.regular_price,\n            saleprice: matchedVariable.sale_price\n          });\n        } else {\n          tempVariable = _objectSpread(_objectSpread({}, productItem), {}, {\n            regularprice: productItem.dregularprice,\n            saleprice: productItem.dsaleprice\n          });\n        }\n      }\n    } else {\n      if (productItem.producttype === \"simple\" || productItem.combo) {\n        tempVariable = _objectSpread(_objectSpread({}, productItem), {}, {\n          regularprice: productItem.dregularprice,\n          saleprice: productItem.dsaleprice\n        });\n      }\n    }\n\n    return tempVariable;\n  }\n};\nexport const changeCartItemVariation = (varValue, names, item, indexingNo, list) => {\n  if (names === \"qty\") {\n    return {\n      approve: false,\n      update: {\n        oldItem: item,\n        newItem: _objectSpread(_objectSpread({}, item), {}, {\n          [names]: varValue\n        }),\n        remove: null\n      }\n    };\n  } else {\n    const totalVariation = getTotalVariation(item);\n    const foundItem = list.find((el, index) => {\n      const innerFlag = totalVariation.map(varEl => {\n        if (el[varEl]) {\n          if (varEl === names) {\n            return el[varEl].value === varValue.value;\n          }\n\n          return el[varEl].value === item[varEl].value;\n        } else {\n          return null;\n        }\n      }).filter(el => el !== null);\n      return el.productid._id === item.productid._id && innerFlag.every(el => el) && index !== indexingNo;\n    });\n\n    if (foundItem !== undefined && foundItem !== null) {\n      const totalQty = parseInt(foundItem.qty) + parseInt(item.qty);\n      const qty = totalQty;\n\n      if (item.subscribed || foundItem.subscribed) {\n        return {\n          approve: true,\n          update: {\n            oldItem: foundItem,\n            newItem: _objectSpread(_objectSpread({}, foundItem), {}, {\n              [names]: varValue,\n              qty,\n              subscribed: true,\n              subscribedDiscountPersent: item.subscribedDiscountPersent,\n              subscribedTime: item.subscribedTime\n            }),\n            remove: item\n          }\n        };\n      } else {\n        return {\n          approve: false,\n          update: {\n            oldItem: foundItem,\n            newItem: _objectSpread(_objectSpread({}, foundItem), {}, {\n              [names]: varValue,\n              qty\n            }),\n            remove: item\n          }\n        };\n      }\n    } else {\n      return {\n        approve: false,\n        update: {\n          oldItem: item,\n          newItem: _objectSpread(_objectSpread({}, item), {}, {\n            [names]: varValue\n          }),\n          remove: null\n        }\n      };\n    }\n  }\n};\nexport const verifyProduct = (productItem, items = []) => {\n  const totalVariation = getTotalVariation(productItem);\n  const foundItem = items.find(el => {\n    const innerFlag = totalVariation.map(varEl => {\n      if (el[varEl]) {\n        return el[varEl].value === productItem[varEl].value;\n      } else {\n        return null;\n      }\n    }).filter(el => el !== null).every(el => el);\n    if (!innerFlag) return innerFlag;\n    if (el.combo && productItem.combo) return el._id === productItem._id;\n    if (el.combo) return el._id === productItem.productid._id;\n    if (productItem.combo) return el.productid._id === productItem._id;\n    return el.productid._id === productItem.productid._id;\n  });\n\n  if (foundItem !== undefined && foundItem !== null) {\n    const totalQty = parseInt(foundItem.qty) + parseInt(productItem.qty);\n    const qty = totalQty;\n\n    const tempNewItem = _objectSpread(_objectSpread({}, foundItem), {}, {\n      subscribed: productItem.subscribed\n    });\n\n    if (productItem.subscribed) {\n      const {\n        subscribed,\n        subscribedDiscountPersent,\n        subscribedTime\n      } = productItem;\n      return {\n        found: foundItem,\n        item: _objectSpread(_objectSpread({}, foundItem), {}, {\n          qty: qty,\n          subscribed,\n          subscribedDiscountPersent,\n          subscribedTime\n        })\n      };\n    } else if (foundItem.subscribed) {\n      const {\n        subscribedDiscountPersent,\n        subscribedTime\n      } = tempNewItem,\n            newItem = _objectWithoutProperties(tempNewItem, [\"subscribedDiscountPersent\", \"subscribedTime\"]);\n\n      return {\n        found: foundItem,\n        item: _objectSpread({}, newItem)\n      };\n    }\n\n    return {\n      found: foundItem,\n      item: _objectSpread(_objectSpread({}, foundItem), {}, {\n        qty: qty,\n        subscribed: productItem.subscribed\n      })\n    };\n  }\n\n  return {\n    found: null,\n    item: _objectSpread({}, productItem)\n  };\n};\nexport const addItem = (state, newItem) => {\n  const {\n    found,\n    item\n  } = verifyProduct(newItem, state.items);\n\n  if (found) {\n    return modifyProduct(found, item, state);\n  }\n\n  const newItems = [...state.items, newItem];\n  return _objectSpread(_objectSpread({}, state), {}, {\n    items: newItems,\n    subTotal: returnSubTotal(newItems) || 0,\n    unSubscribeProductAmount: returnUnSubscribeTotal(newItems) || 0,\n    totalWeight: getTotalWeight(newItems),\n    totalVolume: getTotalVolume(newItems)\n  });\n};\nexport const setSlugInCart = cart => {\n  return _objectSpread(_objectSpread({}, cart), {}, {\n    items: cart.items ? cart.items.map(el => addSlugToProduct(el)) : []\n  });\n};\nexport const modifyProduct = (oldItem, newItem, state) => {\n  const NewItems = state.items.map(el => {\n    if (el._id === newItem._id) {\n      if (el === oldItem) {\n        return variablePriceSet(newItem);\n      }\n    }\n\n    return el;\n  });\n\n  if (oldItem !== newItem) {\n    return _objectSpread(_objectSpread({}, state), {}, {\n      items: [...NewItems],\n      subTotal: returnSubTotal(NewItems) || 0,\n      unSubscribeProductAmount: returnUnSubscribeTotal(NewItems) || 0,\n      totalWeight: getTotalWeight(NewItems),\n      totalVolume: getTotalVolume(NewItems),\n      taxCouponDiscount: NewItems.length === 0 ? 0 : state.taxCouponDiscount,\n      taxCouponCode: NewItems.length === 0 ? 0 : state.taxCouponCode\n    });\n  }\n\n  return state;\n};\nexport const removeItem = (state, item) => {\n  console.log(state);\n  const newItems = [...state.items.filter(el => el !== item)];\n  return _objectSpread(_objectSpread({}, state), {}, {\n    items: newItems,\n    subTotal: returnSubTotal(newItems) || 0,\n    unSubscribeProductAmount: returnUnSubscribeTotal(newItems) || 0,\n    totalWeight: getTotalWeight(newItems),\n    totalVolume: getTotalVolume(newItems),\n    taxCouponDiscount: newItems.length === 0 ? 0 : state.taxCouponDiscount,\n    taxCouponCode: newItems.length === 0 ? 0 : state.taxCouponCode\n  });\n};\nexport const getItemsHeightWidth = items => {\n  var height = 0;\n  var width = 0;\n  var length = 0;\n  var weight = 0;\n\n  function flatten(arr) {\n    return arr.reduce(function (flat, toFlatten) {\n      return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\n    }, []);\n  }\n\n  const item = flatten(items.map(el => {\n    const qty = el.qty ? parseInt(el.qty) : 1;\n    if (qty > 1) return new Array(qty).fill(el);\n    return el;\n  }));\n\n  const getGreater = (a, b) => {\n    if (a > b) return a;\n    return b;\n  };\n\n  if (item.length > 0) {\n    item.forEach(itm => {\n      weight = weight + itm.weight;\n    });\n  }\n\n  const itemsB = items.map(el => ({\n    h: el.shipping_height,\n    l: el.shipping_length,\n    w: el.shipping_width,\n    qty: el.qty\n  }));\n  const itemsC = [].concat.apply([], itemsB);\n  const itemsC1 = itemsC.map(el => new Array(el.qty).fill(el)).flat();\n  const itemsD = combineLoop(itemsC1)[0];\n  return {\n    height: itemsD.h,\n    width: itemsD.w,\n    length: itemsD.l,\n    weight\n  };\n};\nexport const filterShippingRates = rateArr => {\n  if (rateArr.length > 0) {\n    const filteredRates = _.uniqBy(rateArr, function (e) {\n      return e.service;\n    });\n\n    const smallSorted = filteredRates.sort((a, b) => parseFloat(a.rate || 0) - parseFloat(b.rate || 0));\n    const Smallest = smallSorted[0];\n    const Smallest1 = smallSorted[1];\n    const Smallest2 = smallSorted[2];\n    const PriorityRaw = filteredRates.find(el => el.service === \"Priority\");\n    const ExpressRaw = filteredRates.find(el => el.service === \"Express\");\n    const {\n      shippingExtraRate\n    } = projectSettings;\n\n    const standard = Smallest && _objectSpread(_objectSpread({}, Smallest), {}, {\n      customName: \"Standard\",\n      customRate: parseFloat(Smallest.rate) + shippingExtraRate\n    });\n\n    const Priority = Smallest1 && _objectSpread(_objectSpread({}, Smallest1), {}, {\n      customName: \"Priority\",\n      customRate: parseFloat(Smallest1.rate) + shippingExtraRate\n    });\n\n    const Express = Smallest2 && _objectSpread(_objectSpread({}, Smallest2), {}, {\n      customName: \"Express\",\n      customRate: parseFloat(Smallest2.rate) + shippingExtraRate\n    });\n\n    return [standard, Priority, Express].filter(el => el);\n  }\n\n  return rateArr;\n}; // --------------------------\n\nconst multiply = (a, b) => {\n  return parseFloat(a) * parseFloat(b);\n};\n\nconst getSelectedAttributes = item => {\n  if (item.producttype === \"variable\") return item.attributes.map(el => ({\n    [el.names]: item[el.names].value\n  })).filter(el => el).reduce((a, b) => _objectSpread(_objectSpread({}, a), b), {});\n  return null;\n};\n\nconst getDiscount = (discount, subTotal) => {\n  return discount * subTotal / 100 || 0;\n};\n\nconst removeEmpty = obj => {\n  Object.keys(obj).forEach(key => obj[key] === null && delete obj[key]);\n};\n\nconst parseOrderProduct = item => {\n  const isCombo = item.combo ? true : false,\n        comboId = item.combo ? item._id : null,\n        productId = item.combo ? null : item.productid._id,\n        productMeta = item.combo ? null : item._id,\n        isSubscribed = item.subscribed ? true : false,\n        subscriptionMeta = item.subscribed ? {\n    duration: item.subscribedTime\n  } : null,\n        itemId = item._id,\n        _id = item._id,\n        qty = item.qty,\n        title = item.combo ? item.title : item.productid.producttitle,\n        unitPrice = item.saleprice ? item.saleprice : item.regularprice,\n        subTotal = item.saleprice ? multiply(item.saleprice, item.qty) : multiply(item.regularprice, item.qty),\n        attribute = getSelectedAttributes(item),\n        height = item.shipping_height,\n        width = item.shipping_width,\n        length = item.shipping_length,\n        volume = item.volume,\n        weight = item.weight;\n  const order = {\n    isCombo,\n    comboId,\n    productId,\n    productMeta,\n    isSubscribed,\n    subscriptionMeta,\n    itemId,\n    _id,\n    qty,\n    unitPrice,\n    subTotal,\n    attribute,\n    width,\n    length,\n    height,\n    title,\n    volume,\n    weight\n  };\n  removeEmpty(order);\n  return order;\n};\n\nconst getHeightWeight = items => {\n  const height = items.map(el => el.height * parseFloat(el.qty));\n  const width = items.map(el => el.width * parseFloat(el.qty));\n  const length = items.map(el => el.length * parseFloat(el.qty));\n  const shape = {\n    height: height.reduce((a, b) => a + b, 0),\n    width: width.reduce((a, b) => a + b, 0),\n    length: length.reduce((a, b) => a + b, 0)\n  };\n  return shape;\n};\n\nexport const getGrandTotal = (subTotal, taxPercent, shippingCharge, discount) => {\n  const amountWithTax = subTotal + (taxPercent || 0) * subTotal + shippingCharge;\n  const discountAmount = getDiscount(discount, subTotal);\n  const total = parseFloat(amountWithTax || 0) - parseFloat(discountAmount || 0);\n  return parseFloat(total.toFixed(2));\n};\nexport const generateOrderObj = ({\n  stateObj,\n  referralId,\n  cart,\n  user,\n  confirmShipRes\n}) => {\n  const {\n    service\n  } = confirmShipRes,\n        confirmRest = _objectWithoutProperties(confirmShipRes, [\"service\"]);\n\n  const {\n    paymentMethod,\n    address,\n    billingAddress\n  } = stateObj;\n\n  const {\n    addressStr\n  } = address,\n        addressRest = _objectWithoutProperties(address, [\"addressStr\"]);\n\n  const {\n    addressStr: billingAddressStr\n  } = billingAddress,\n        billingAddressRest = _objectWithoutProperties(billingAddress, [\"addressStr\"]);\n\n  const {\n    items,\n    shippingCharge,\n    subTotal,\n    totalWeight,\n    totalVolume,\n    taxValue,\n    taxPercent,\n    taxCouponDiscount,\n    taxCouponCode\n  } = cart;\n  const orderProducts = items.map(el => parseOrderProduct(el));\n  const {\n    height: totalHeight,\n    length: totalLength,\n    width: totalWidth\n  } = getHeightWeight(orderProducts);\n\n  const order = _objectSpread({\n    totalVolume,\n    totalWeight,\n    shippingMethod: service,\n    products: orderProducts,\n    countryTax: (taxPercent || 0) * 100,\n    taxAmount: taxValue || parseFloat(cart.subTotal || 0) * parseFloat(taxPercent || 0) || 0,\n    shippingCharge,\n    userDetails: _objectSpread({\n      address: addressStr\n    }, addressRest),\n    billingAddress: _objectSpread({\n      address: billingAddressStr\n    }, billingAddressRest),\n    orderStatus: projectSettings.defaultOrderStatus,\n    paymentMethod: paymentMethod === \"stripe\" ? \"Authorize\" : paymentMethod,\n    status: projectSettings.defaultStatusInOrder,\n    wholeSubtotal: parseFloat(subTotal.toFixed(2)),\n    wasReferred: referralId ? true : false,\n    referral: referralId ? referralId : null,\n    isCoupon: taxCouponCode ? true : false,\n    couponId: taxCouponCode,\n    couponDisc: taxCouponCode ? taxCouponDiscount : null,\n    grandTotal: getGrandTotal(subTotal, taxPercent, shippingCharge, taxCouponDiscount),\n    isGuest: user._id ? false : true,\n    userId: user._id ? user._id : null,\n    userMetaId: user.userMetaId ? user.userMetaId : null,\n    totalHeight,\n    totalWidth,\n    totalLength,\n    refPercentage: projectSettings.referralPresent\n  }, confirmRest);\n\n  removeEmpty(order);\n  return order;\n};","map":{"version":3,"sources":["/Users/akshataggarwal/Documents/Coding Files/webd projects/missvalentine-front/services/helpers/cart.js"],"names":["combineLoop","addSlugToProduct","_","projectSettings","getItemTotal","item","saleprice","parseFloat","qty","regularprice","returnSubTotal","items","map","el","subscribed","totalPrice","disc","subscribedDiscountPersent","reduce","a","b","returnUnSubscribeTotal","filter","getTotalWeight","weight","getTotalVolume","volume","getTotalVariation","attributes","names","variablePriceSet","productItem","tempVariable","producttype","notNullVariation","variation","varCheck","attr","key","value","matchedVariable","some","vEl","undefined","find","varEl","matchArr","push","includes","regular_price","sale_price","dregularprice","dsaleprice","combo","changeCartItemVariation","varValue","indexingNo","list","approve","update","oldItem","newItem","remove","totalVariation","foundItem","index","innerFlag","productid","_id","every","totalQty","parseInt","subscribedTime","verifyProduct","tempNewItem","found","addItem","state","modifyProduct","newItems","subTotal","unSubscribeProductAmount","totalWeight","totalVolume","setSlugInCart","cart","NewItems","taxCouponDiscount","length","taxCouponCode","removeItem","console","log","getItemsHeightWidth","height","width","flatten","arr","flat","toFlatten","concat","Array","isArray","fill","getGreater","forEach","itm","itemsB","h","shipping_height","l","shipping_length","w","shipping_width","itemsC","apply","itemsC1","itemsD","filterShippingRates","rateArr","filteredRates","uniqBy","e","service","smallSorted","sort","rate","Smallest","Smallest1","Smallest2","PriorityRaw","ExpressRaw","shippingExtraRate","standard","customName","customRate","Priority","Express","multiply","getSelectedAttributes","getDiscount","discount","removeEmpty","obj","Object","keys","parseOrderProduct","isCombo","comboId","productId","productMeta","isSubscribed","subscriptionMeta","duration","itemId","title","producttitle","unitPrice","attribute","order","getHeightWeight","shape","getGrandTotal","taxPercent","shippingCharge","amountWithTax","discountAmount","total","toFixed","generateOrderObj","stateObj","referralId","user","confirmShipRes","confirmRest","paymentMethod","address","billingAddress","addressStr","addressRest","billingAddressStr","billingAddressRest","taxValue","orderProducts","totalHeight","totalLength","totalWidth","shippingMethod","products","countryTax","taxAmount","userDetails","orderStatus","defaultOrderStatus","status","defaultStatusInOrder","wholeSubtotal","wasReferred","referral","isCoupon","couponId","couponDisc","grandTotal","isGuest","userId","userMetaId","refPercentage","referralPresent"],"mappings":"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","sourcesContent":["import { combineLoop } from \"box-dimension-calculator\";\nimport { addSlugToProduct } from \"./product\";\nimport _ from \"lodash\";\nimport projectSettings from \"../../constants/projectSettings\";\n\nexport const getItemTotal = (item) => {\n  if (item) {\n    if (item.saleprice)\n      return parseFloat(item.saleprice) * parseFloat(item.qty);\n    else if (item.regularprice)\n      return parseFloat(item.regularprice) * parseFloat(item.qty);\n  }\n  return 0;\n};\n\nexport const returnSubTotal = (items) => {\n  // amount =\n  return items\n    .map((el) => {\n      if (el) {\n        if (el.saleprice)\n          if (el.subscribed) {\n            const totalPrice = parseFloat(el.saleprice) * parseFloat(el.qty);\n            const disc = (totalPrice * el.subscribedDiscountPersent) / 100;\n            return parseFloat(totalPrice) - parseFloat(disc);\n          } else {\n            return parseFloat(el.saleprice) * parseFloat(el.qty);\n          }\n        else if (el.regularprice)\n          if (el.subscribed) {\n            const totalPrice = parseFloat(el.regularprice) * parseFloat(el.qty);\n            const disc = (totalPrice * el.subscribedDiscountPersent) / 100;\n            return parseFloat(totalPrice) - parseFloat(disc);\n          } else {\n            return parseFloat(el.regularprice) * parseFloat(el.qty);\n          }\n      }\n\n      return 0;\n    })\n    .reduce((a, b) => a + b, 0);\n};\nexport const returnUnSubscribeTotal = (items) => {\n  return items\n    .filter((el) => !el.subscribed)\n    .map((el) => {\n      if (el) {\n        if (el.saleprice) return parseFloat(el.saleprice) * parseFloat(el.qty);\n        else if (el.regularprice)\n          return parseFloat(el.regularprice) * parseFloat(el.qty);\n      }\n\n      return 0;\n    })\n    .reduce((a, b) => a + b, 0);\n};\nexport const getTotalWeight = (items) => {\n  return items\n    .filter((el) => el.weight)\n    .map((el) => el.weight * parseFloat(el.qty))\n    .reduce((a, b) => a + b, 0);\n};\nexport const getTotalVolume = (items) => {\n  // return items\n  //   .filter(el => el.shipping_height && el.shipping_length && el.shipping_width)\n  //   .map(el => el.shipping_height * el.shipping_length * el.shipping_width)\n  //   .reduce((a, b) => a + b, 0);\n  return items\n    .filter((el) => el.volume)\n    .map((el) => el.volume * parseFloat(el.qty))\n    .reduce((a, b) => a + b, 0);\n};\nexport const getTotalVariation = (item) => {\n  if (!item.attributes) return [];\n\n  return item.attributes.map((el) => (el ? el.names : null)).filter((el) => el);\n};\nexport const variablePriceSet = (productItem) => {\n  if (productItem) {\n    let tempVariable = { ...productItem };\n    if (productItem.producttype === \"variable\") {\n      // if (productItem.size && productItem.extract_flavor) {\n      const notNullVariation = productItem.variation.filter(\n        (el) => el !== null\n      );\n      productItem.attributes.filter((el) => el !== null).map((el) => el.names);\n      const varCheck = productItem.attributes\n        .filter((el) => el !== null)\n        .map((attr) => {\n          return {\n            key: attr.names,\n            value: productItem[attr.names]\n              ? productItem[attr.names].value\n              : productItem[attr.names],\n          };\n        });\n      let matchedVariable = null;\n      if (\n        !varCheck.some((vEl) => vEl.value === null || vEl.value === undefined)\n      ) {\n        matchedVariable = notNullVariation.find((varEl) => {\n          let matchArr = [];\n          varCheck.map((vEl) => {\n            matchArr.push(varEl[vEl.key] === vEl.value);\n            return null;\n          });\n\n          return !matchArr.includes(false);\n        });\n        if (matchedVariable) {\n          tempVariable = {\n            ...productItem,\n            regularprice: matchedVariable.regular_price,\n            saleprice: matchedVariable.sale_price,\n          };\n        } else {\n          tempVariable = {\n            ...productItem,\n            regularprice: productItem.dregularprice,\n            saleprice: productItem.dsaleprice,\n          };\n        }\n      }\n    } else {\n      if (productItem.producttype === \"simple\" || productItem.combo) {\n        tempVariable = {\n          ...productItem,\n          regularprice: productItem.dregularprice,\n          saleprice: productItem.dsaleprice,\n        };\n      }\n    }\n\n    return tempVariable;\n  }\n};\nexport const changeCartItemVariation = (\n  varValue,\n  names,\n  item,\n  indexingNo,\n  list\n) => {\n  if (names === \"qty\") {\n    return {\n      approve: false,\n      update: {\n        oldItem: item,\n        newItem: { ...item, [names]: varValue },\n        remove: null,\n      },\n    };\n  } else {\n    const totalVariation = getTotalVariation(item);\n\n    const foundItem = list.find((el, index) => {\n      const innerFlag = totalVariation\n        .map((varEl) => {\n          if (el[varEl]) {\n            if (varEl === names) {\n              return el[varEl].value === varValue.value;\n            }\n            return el[varEl].value === item[varEl].value;\n          } else {\n            return null;\n          }\n        })\n        .filter((el) => el !== null);\n\n      return (\n        el.productid._id === item.productid._id &&\n        innerFlag.every((el) => el) &&\n        index !== indexingNo\n      );\n    });\n    if (foundItem !== undefined && foundItem !== null) {\n      const totalQty = parseInt(foundItem.qty) + parseInt(item.qty);\n      const qty = totalQty;\n\n      if (item.subscribed || foundItem.subscribed) {\n        return {\n          approve: true,\n          update: {\n            oldItem: foundItem,\n            newItem: {\n              ...foundItem,\n              [names]: varValue,\n              qty,\n              subscribed: true,\n              subscribedDiscountPersent: item.subscribedDiscountPersent,\n              subscribedTime: item.subscribedTime,\n            },\n            remove: item,\n          },\n        };\n      } else {\n        return {\n          approve: false,\n          update: {\n            oldItem: foundItem,\n            newItem: {\n              ...foundItem,\n              [names]: varValue,\n              qty,\n            },\n            remove: item,\n          },\n        };\n      }\n    } else {\n      return {\n        approve: false,\n        update: {\n          oldItem: item,\n          newItem: {\n            ...item,\n            [names]: varValue,\n          },\n          remove: null,\n        },\n      };\n    }\n  }\n};\nexport const verifyProduct = (productItem, items = []) => {\n  const totalVariation = getTotalVariation(productItem);\n\n  const foundItem = items.find((el) => {\n    const innerFlag = totalVariation\n      .map((varEl) => {\n        if (el[varEl]) {\n          return el[varEl].value === productItem[varEl].value;\n        } else {\n          return null;\n        }\n      })\n      .filter((el) => el !== null)\n      .every((el) => el);\n\n    if (!innerFlag) return innerFlag;\n\n    if (el.combo && productItem.combo) return el._id === productItem._id;\n\n    if (el.combo) return el._id === productItem.productid._id;\n\n    if (productItem.combo) return el.productid._id === productItem._id;\n\n    return el.productid._id === productItem.productid._id;\n  });\n\n  if (foundItem !== undefined && foundItem !== null) {\n    const totalQty = parseInt(foundItem.qty) + parseInt(productItem.qty);\n    const qty = totalQty;\n    const tempNewItem = {\n      ...foundItem,\n      subscribed: productItem.subscribed,\n    };\n    if (productItem.subscribed) {\n      const {\n        subscribed,\n        subscribedDiscountPersent,\n        subscribedTime,\n      } = productItem;\n      return {\n        found: foundItem,\n        item: {\n          ...foundItem,\n          qty: qty,\n          subscribed,\n          subscribedDiscountPersent,\n          subscribedTime,\n        },\n      };\n    } else if (foundItem.subscribed) {\n      const {\n        subscribedDiscountPersent,\n        subscribedTime,\n        ...newItem\n      } = tempNewItem;\n      return {\n        found: foundItem,\n        item: {\n          ...newItem,\n        },\n      };\n    }\n    return {\n      found: foundItem,\n      item: {\n        ...foundItem,\n        qty: qty,\n        subscribed: productItem.subscribed,\n      },\n    };\n  }\n  return {\n    found: null,\n    item: {\n      ...productItem,\n    },\n  };\n};\nexport const addItem = (state, newItem) => {\n  const { found, item } = verifyProduct(newItem, state.items);\n\n  if (found) {\n    return modifyProduct(found, item, state);\n  }\n  const newItems = [...state.items, newItem];\n\n  return {\n    ...state,\n    items: newItems,\n    subTotal: returnSubTotal(newItems) || 0,\n    unSubscribeProductAmount: returnUnSubscribeTotal(newItems) || 0,\n    totalWeight: getTotalWeight(newItems),\n    totalVolume: getTotalVolume(newItems),\n  };\n};\nexport const setSlugInCart = (cart) => {\n  return {\n    ...cart,\n    items: cart.items ? cart.items.map((el) => addSlugToProduct(el)) : [],\n  };\n};\nexport const modifyProduct = (oldItem, newItem, state) => {\n  const NewItems = state.items.map((el) => {\n    if (el._id === newItem._id) {\n      if (el === oldItem) {\n        return variablePriceSet(newItem);\n      }\n    }\n    return el;\n  });\n  if (oldItem !== newItem) {\n    return {\n      ...state,\n      items: [...NewItems],\n      subTotal: returnSubTotal(NewItems) || 0,\n      unSubscribeProductAmount: returnUnSubscribeTotal(NewItems) || 0,\n      totalWeight: getTotalWeight(NewItems),\n      totalVolume: getTotalVolume(NewItems),\n      taxCouponDiscount: NewItems.length === 0 ? 0 : state.taxCouponDiscount,\n      taxCouponCode: NewItems.length === 0 ? 0 : state.taxCouponCode,\n    };\n  }\n  return state;\n};\nexport const removeItem = (state, item) => {\n  console.log(state);\n  const newItems = [...state.items.filter((el) => el !== item)];\n  return {\n    ...state,\n    items: newItems,\n    subTotal: returnSubTotal(newItems) || 0,\n    unSubscribeProductAmount: returnUnSubscribeTotal(newItems) || 0,\n    totalWeight: getTotalWeight(newItems),\n    totalVolume: getTotalVolume(newItems),\n    taxCouponDiscount: newItems.length === 0 ? 0 : state.taxCouponDiscount,\n    taxCouponCode: newItems.length === 0 ? 0 : state.taxCouponCode,\n  };\n};\nexport const getItemsHeightWidth = (items) => {\n  var height = 0;\n  var width = 0;\n  var length = 0;\n  var weight = 0;\n  function flatten(arr) {\n    return arr.reduce(function(flat, toFlatten) {\n      return flat.concat(\n        Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten\n      );\n    }, []);\n  }\n  const item = flatten(\n    items.map((el) => {\n      const qty = el.qty ? parseInt(el.qty) : 1;\n      if (qty > 1) return new Array(qty).fill(el);\n\n      return el;\n    })\n  );\n  const getGreater = (a, b) => {\n    if (a > b) return a;\n    return b;\n  };\n  if (item.length > 0) {\n    item.forEach((itm) => {\n      weight = weight + itm.weight;\n    });\n  }\n  const itemsB = items.map((el) => ({\n    h: el.shipping_height,\n    l: el.shipping_length,\n    w: el.shipping_width,\n    qty: el.qty,\n  }));\n  const itemsC = [].concat.apply([], itemsB);\n  const itemsC1 = itemsC.map((el) => new Array(el.qty).fill(el)).flat();\n  const itemsD = combineLoop(itemsC1)[0];\n\n  return {\n    height: itemsD.h,\n    width: itemsD.w,\n    length: itemsD.l,\n    weight,\n  };\n};\nexport const filterShippingRates = (rateArr) => {\n  if (rateArr.length > 0) {\n    const filteredRates = _.uniqBy(rateArr, function(e) {\n      return e.service;\n    });\n    const smallSorted = filteredRates.sort(\n      (a, b) => parseFloat(a.rate || 0) - parseFloat(b.rate || 0)\n    );\n    const Smallest = smallSorted[0];\n    const Smallest1 = smallSorted[1];\n    const Smallest2 = smallSorted[2];\n    const PriorityRaw = filteredRates.find((el) => el.service === \"Priority\");\n    const ExpressRaw = filteredRates.find((el) => el.service === \"Express\");\n    const { shippingExtraRate } = projectSettings;\n    const standard = Smallest && {\n      ...Smallest,\n      customName: \"Standard\",\n      customRate: parseFloat(Smallest.rate) + shippingExtraRate,\n    };\n    const Priority = Smallest1 && {\n      ...Smallest1,\n      customName: \"Priority\",\n      customRate: parseFloat(Smallest1.rate) + shippingExtraRate,\n    };\n    const Express = Smallest2 && {\n      ...Smallest2,\n      customName: \"Express\",\n      customRate: parseFloat(Smallest2.rate) + shippingExtraRate,\n    };\n    return [standard, Priority, Express].filter((el) => el);\n  }\n  return rateArr;\n};\n// --------------------------\n\nconst multiply = (a, b) => {\n  return parseFloat(a) * parseFloat(b);\n};\nconst getSelectedAttributes = (item) => {\n  if (item.producttype === \"variable\")\n    return item.attributes\n      .map((el) => ({\n        [el.names]: item[el.names].value,\n      }))\n      .filter((el) => el)\n      .reduce(\n        (a, b) => ({\n          ...a,\n          ...b,\n        }),\n        {}\n      );\n  return null;\n};\nconst getDiscount = (discount, subTotal) => {\n  return (discount * subTotal) / 100 || 0;\n};\nconst removeEmpty = (obj) => {\n  Object.keys(obj).forEach((key) => obj[key] === null && delete obj[key]);\n};\nconst parseOrderProduct = (item) => {\n  const isCombo = item.combo ? true : false,\n    comboId = item.combo ? item._id : null,\n    productId = item.combo ? null : item.productid._id,\n    productMeta = item.combo ? null : item._id,\n    isSubscribed = item.subscribed ? true : false,\n    subscriptionMeta = item.subscribed\n      ? {\n          duration: item.subscribedTime,\n        }\n      : null,\n    itemId = item._id,\n    _id = item._id,\n    qty = item.qty,\n    title = item.combo ? item.title : item.productid.producttitle,\n    unitPrice = item.saleprice ? item.saleprice : item.regularprice,\n    subTotal = item.saleprice\n      ? multiply(item.saleprice, item.qty)\n      : multiply(item.regularprice, item.qty),\n    attribute = getSelectedAttributes(item),\n    height = item.shipping_height,\n    width = item.shipping_width,\n    length = item.shipping_length,\n    volume = item.volume,\n    weight = item.weight;\n\n  const order = {\n    isCombo,\n    comboId,\n    productId,\n    productMeta,\n    isSubscribed,\n    subscriptionMeta,\n    itemId,\n    _id,\n    qty,\n    unitPrice,\n    subTotal,\n    attribute,\n    width,\n    length,\n    height,\n    title,\n    volume,\n    weight,\n  };\n  removeEmpty(order);\n  return order;\n};\nconst getHeightWeight = (items) => {\n  const height = items.map((el) => el.height * parseFloat(el.qty));\n  const width = items.map((el) => el.width * parseFloat(el.qty));\n  const length = items.map((el) => el.length * parseFloat(el.qty));\n  const shape = {\n    height: height.reduce((a, b) => a + b, 0),\n    width: width.reduce((a, b) => a + b, 0),\n    length: length.reduce((a, b) => a + b, 0),\n  };\n  return shape;\n};\nexport const getGrandTotal = (\n  subTotal,\n  taxPercent,\n  shippingCharge,\n  discount\n) => {\n  const amountWithTax =\n    subTotal + (taxPercent || 0) * subTotal + shippingCharge;\n  const discountAmount = getDiscount(discount, subTotal);\n  const total =\n    parseFloat(amountWithTax || 0) - parseFloat(discountAmount || 0);\n  return parseFloat(total.toFixed(2));\n};\nexport const generateOrderObj = ({\n  stateObj,\n  referralId,\n  cart,\n  user,\n  confirmShipRes,\n}) => {\n  const { service, ...confirmRest } = confirmShipRes;\n  const { paymentMethod, address, billingAddress } = stateObj;\n  const { addressStr, ...addressRest } = address;\n  const {\n    addressStr: billingAddressStr,\n    ...billingAddressRest\n  } = billingAddress;\n  const {\n    items,\n    shippingCharge,\n    subTotal,\n    totalWeight,\n    totalVolume,\n    taxValue,\n    taxPercent,\n    taxCouponDiscount,\n    taxCouponCode,\n  } = cart;\n  const orderProducts = items.map((el) => parseOrderProduct(el));\n  const {\n    height: totalHeight,\n    length: totalLength,\n    width: totalWidth,\n  } = getHeightWeight(orderProducts);\n  const order = {\n    totalVolume,\n    totalWeight,\n    shippingMethod: service,\n    products: orderProducts,\n    countryTax: (taxPercent || 0) * 100,\n    taxAmount:\n      taxValue ||\n      parseFloat(cart.subTotal || 0) * parseFloat(taxPercent || 0) ||\n      0,\n    shippingCharge,\n    userDetails: {\n      address: addressStr,\n      ...addressRest,\n    },\n    billingAddress: {\n      address: billingAddressStr,\n      ...billingAddressRest,\n    },\n    orderStatus: projectSettings.defaultOrderStatus,\n    paymentMethod: paymentMethod === \"stripe\" ? \"Authorize\" : paymentMethod,\n    status: projectSettings.defaultStatusInOrder,\n    wholeSubtotal: parseFloat(subTotal.toFixed(2)),\n    wasReferred: referralId ? true : false,\n    referral: referralId ? referralId : null,\n    isCoupon: taxCouponCode ? true : false,\n    couponId: taxCouponCode,\n    couponDisc: taxCouponCode ? taxCouponDiscount : null,\n    grandTotal: getGrandTotal(\n      subTotal,\n      taxPercent,\n      shippingCharge,\n      taxCouponDiscount\n    ),\n    isGuest: user._id ? false : true,\n    userId: user._id ? user._id : null,\n    userMetaId: user.userMetaId ? user.userMetaId : null,\n    totalHeight,\n    totalWidth,\n    totalLength,\n    refPercentage: projectSettings.referralPresent,\n    ...confirmRest,\n  };\n  removeEmpty(order);\n  return order;\n};\n"]},"metadata":{},"sourceType":"module"}